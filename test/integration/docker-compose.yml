
version: "3.9"
services:
  bindplane:
    hostname: bindplane.bindplane-dev.svc.cluster.local
    image: observiq/bindplane-ee:${BINDPLANE_VERSION}
    restart: always
    ports:
      - "3100:3001"
    environment:
      - BINDPLANE_USERNAME=tfu
      - BINDPLANE_PASSWORD=tfp
      - BINDPLANE_SECRET_KEY=524abde2-d9f8-485c-b426-bac229686d13
      - BINDPLANE_SESSION_SECRET=524abde2-d9f8-485c-b426-bac229686d13
      - BINDPLANE_LOGGING_OUTPUT=stdout
      - BINDPLANE_TLS_CERT=/bindplane.crt
      - BINDPLANE_TLS_KEY=/bindplane.key
      - BINDPLANE_TLS_CA=/bindplane-ca.crt
      - BINDPLANE_REMOTE_URL=https://bindplane.bindplane-dev.svc.cluster.local:3001
      - BINDPLANE_LICENSE=${BINDPLANE_LICENSE}
      - BINDPLANE_ACCEPT_EULA=true
    volumes:
      - "../../client/tls/bindplane.crt:/bindplane-ca.crt:ro"
      - "../../client/tls/bindplane.crt:/bindplane.crt:ro"
      - "../../client/tls/bindplane.key:/bindplane.key:ro"

  agent:
    image: observiq/bindplane-agent:1.36.0
    environment:
      - OPAMP_AGENT_NAME=agent
      - OPAMP_ENDPOINT=wss://bindplane.bindplane-dev.svc.cluster.local:3001/v1/opamp
      - OPAMP_SECRET_KEY=524abde2-d9f8-485c-b426-bac229686d13
      - OPAMP_LABELS=configuration=testtf
      - OPAMP_TLS_CA=/etc/otel/bindplane-ca.crt
      - OPAMP_TLS_CERT=/etc/otel/bindplane-client.crt
      - OPAMP_TLS_KEY=/etc/otel/bindplane-client.key
    restart: always
    depends_on:
      - bindplane
    volumes:
      - "../../client/tls/bindplane-ca.crt:/etc/otel/bindplane-ca.crt:ro"
      - "../../client/tls/bindplane-client.crt:/etc/otel/bindplane-client.crt:ro"
      - "../../client/tls/bindplane-client.key:/etc/otel/bindplane-client.key:ro"
